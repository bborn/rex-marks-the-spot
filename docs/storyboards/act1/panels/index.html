<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fairy Dinosaur Date Night - Act 1 Storyboard</title>
    <style>
        :root {
            --bg-dark: #1a1a2e;
            --bg-medium: #16213e;
            --accent: #0096ff;
            --text-light: #eaeaea;
            --text-muted: #888;
            --scene-home: #FFE4B5;
            --scene-storm: #2F4F4F;
            --scene-car: #1C1C1C;
            --scene-warp: #0096FF;
            --scene-jurassic: #228B22;
            --scene-cave: #4a4a4a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg-dark);
            color: var(--text-light);
            min-height: 100vh;
        }

        header {
            background: var(--bg-medium);
            padding: 1.5rem 2rem;
            border-bottom: 3px solid var(--accent);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }

        h1 span {
            color: var(--accent);
        }

        .controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .view-toggle {
            display: flex;
            background: var(--bg-dark);
            border-radius: 8px;
            overflow: hidden;
        }

        .view-toggle button {
            padding: 0.5rem 1rem;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
        }

        .view-toggle button.active {
            background: var(--accent);
            color: white;
        }

        .scene-nav {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            padding: 1rem 2rem;
            background: rgba(0,0,0,0.2);
        }

        .scene-btn {
            padding: 0.5rem 1rem;
            background: var(--bg-medium);
            border: 2px solid transparent;
            border-radius: 6px;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85rem;
        }

        .scene-btn:hover {
            border-color: var(--accent);
        }

        .scene-btn.active {
            background: var(--accent);
            color: white;
        }

        .scene-btn[data-vfx="true"]::after {
            content: " VFX";
            font-size: 0.7rem;
            color: #ff6b6b;
            font-weight: bold;
        }

        main {
            max-width: 1800px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Grid View */
        .panels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 1.5rem;
        }

        .panel-card {
            background: var(--bg-medium);
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .panel-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0, 150, 255, 0.2);
        }

        .panel-card img,
        .panel-card object {
            width: 100%;
            aspect-ratio: 16/9;
            object-fit: contain;
            background: #000;
        }

        .panel-info {
            padding: 1rem;
        }

        .panel-info h3 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .panel-info p {
            font-size: 0.85rem;
            color: var(--text-muted);
            line-height: 1.4;
        }

        .scene-indicator {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            background: var(--accent);
            border-radius: 4px;
            font-size: 0.75rem;
            margin-right: 0.5rem;
        }

        /* Sequence View */
        .panels-sequence {
            display: none;
            flex-direction: column;
            gap: 3rem;
        }

        .panels-sequence.active {
            display: flex;
        }

        .panels-grid.active {
            display: grid;
        }

        .panels-grid:not(.active) {
            display: none;
        }

        .scene-section {
            background: var(--bg-medium);
            border-radius: 16px;
            overflow: hidden;
        }

        .scene-header {
            padding: 1.5rem 2rem;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .scene-header h2 {
            font-size: 1.3rem;
        }

        .scene-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .scene-panels {
            display: flex;
            overflow-x: auto;
            gap: 1rem;
            padding: 1.5rem;
            scroll-snap-type: x mandatory;
        }

        .scene-panels .panel-card {
            flex: 0 0 450px;
            scroll-snap-align: start;
        }

        /* Lightbox */
        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .lightbox.active {
            display: flex;
        }

        .lightbox-content {
            max-width: 95vw;
            max-height: 90vh;
            position: relative;
        }

        .lightbox-content img,
        .lightbox-content object {
            max-width: 100%;
            max-height: 85vh;
            object-fit: contain;
        }

        #lightbox-image-png {
            max-width: 100%;
            max-height: 85vh;
            object-fit: contain;
        }

        .lightbox-info {
            position: absolute;
            bottom: -3rem;
            left: 0;
            right: 0;
            text-align: center;
            color: white;
        }

        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: var(--accent);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lightbox-nav.prev { left: -70px; }
        .lightbox-nav.next { right: -70px; }

        .lightbox-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: transparent;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            z-index: 1001;
        }

        /* Progress bar */
        .progress-container {
            padding: 1rem 2rem;
            background: rgba(0,0,0,0.3);
        }

        .progress-bar {
            height: 4px;
            background: var(--bg-medium);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.3s;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* VFX badge */
        .vfx-badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            background: #ff6b6b;
            color: white;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .panels-grid {
                grid-template-columns: 1fr;
            }

            .scene-panels .panel-card {
                flex: 0 0 90%;
            }

            .lightbox-nav {
                display: none;
            }
        }

        /* Feedback System Styles */
        .feedback-badge {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--accent);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            z-index: 10;
        }

        .feedback-badge.has-director {
            background: #ff6b6b;
        }

        .feedback-badge svg {
            width: 12px;
            height: 12px;
        }

        .panel-card {
            position: relative;
        }

        /* Lightbox Feedback Panel */
        .lightbox-feedback {
            position: fixed;
            top: 0;
            right: 0;
            width: 380px;
            height: 100%;
            background: var(--bg-medium);
            border-left: 2px solid var(--accent);
            display: flex;
            flex-direction: column;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1002;
        }

        .lightbox-feedback.active {
            transform: translateX(0);
        }

        .lightbox.active .lightbox-content {
            margin-right: 0;
            transition: margin-right 0.3s ease;
        }

        .lightbox.active.feedback-open .lightbox-content {
            margin-right: 380px;
        }

        .feedback-header {
            padding: 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .feedback-header h3 {
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feedback-toggle {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: var(--accent);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 1003;
        }

        .feedback-toggle:hover {
            background: #0077cc;
        }

        .feedback-comments {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .comment {
            background: var(--bg-dark);
            border-radius: 8px;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .comment.director {
            border-left: 3px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .comment-author {
            font-weight: 600;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .comment-author.director {
            color: #ff6b6b;
        }

        .director-badge {
            background: #ff6b6b;
            color: white;
            padding: 0.1rem 0.4rem;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: bold;
        }

        .comment-time {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .comment-text {
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .comment-status {
            margin-top: 0.5rem;
            font-size: 0.7rem;
        }

        .status-badge {
            display: inline-block;
            padding: 0.1rem 0.4rem;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: bold;
        }

        .status-badge.noted {
            background: #f0ad4e;
            color: #000;
        }

        .status-badge.addressed {
            background: #5cb85c;
            color: white;
        }

        .feedback-form {
            padding: 1rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            background: rgba(0,0,0,0.2);
        }

        .feedback-form textarea {
            width: 100%;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            background: var(--bg-dark);
            color: var(--text-light);
            font-family: inherit;
            font-size: 0.9rem;
            resize: vertical;
            min-height: 80px;
            margin-bottom: 0.5rem;
        }

        .feedback-form textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .feedback-form input[type="text"] {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            border: 1px solid rgba(255,255,255,0.2);
            background: var(--bg-dark);
            color: var(--text-light);
            font-family: inherit;
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
        }

        .feedback-form input[type="text"]:focus {
            outline: none;
            border-color: var(--accent);
        }

        .feedback-form button {
            width: 100%;
            padding: 0.75rem;
            background: var(--accent);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
            font-weight: 600;
        }

        .feedback-form button:hover {
            background: #0077cc;
        }

        .feedback-form button:disabled {
            background: var(--text-muted);
            cursor: not-allowed;
        }

        .feedback-form .form-note {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
            text-align: center;
        }

        .no-comments {
            text-align: center;
            color: var(--text-muted);
            padding: 2rem;
        }

        .loading-comments {
            text-align: center;
            color: var(--text-muted);
            padding: 2rem;
        }

        .feedback-error {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            font-size: 0.85rem;
        }

        .feedback-success {
            background: rgba(92, 184, 92, 0.2);
            color: #5cb85c;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            font-size: 0.85rem;
        }

        /* Director Login Modal */
        .director-login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .director-login-modal.active {
            display: flex;
        }

        .director-login-content {
            background: var(--bg-medium);
            padding: 2rem;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
        }

        .director-login-content h3 {
            margin-bottom: 1rem;
        }

        .director-login-content input {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            background: var(--bg-dark);
            color: var(--text-light);
            font-size: 1rem;
        }

        .director-login-content .btn-row {
            display: flex;
            gap: 0.5rem;
        }

        .director-login-content button {
            flex: 1;
            padding: 0.75rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .director-login-content button.primary {
            background: #ff6b6b;
            color: white;
        }

        .director-login-content button.secondary {
            background: var(--bg-dark);
            color: var(--text-light);
        }

        .director-indicator {
            position: fixed;
            bottom: 1rem;
            left: 1rem;
            background: #ff6b6b;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
            display: none;
            align-items: center;
            gap: 0.5rem;
            z-index: 500;
        }

        .director-indicator.active {
            display: flex;
        }

        .director-indicator button {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            opacity: 0.7;
        }

        .director-indicator button:hover {
            opacity: 1;
        }

        @media (max-width: 900px) {
            .lightbox-feedback {
                width: 100%;
                height: 50%;
                top: auto;
                bottom: 0;
                border-left: none;
                border-top: 2px solid var(--accent);
                transform: translateY(100%);
            }

            .lightbox-feedback.active {
                transform: translateY(0);
            }

            .lightbox.active.feedback-open .lightbox-content {
                margin-right: 0;
                margin-bottom: 50%;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <a href="../../" style="color: var(--text-muted); text-decoration: none; font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem;">
                    <span>←</span> All Acts
                </a>
                <h1><span>Fairy Dinosaur Date Night</span> - Act 1 Storyboard</h1>
            </div>
            <div class="controls">
                <a href="../../act2/panels/" style="color: var(--text-light); text-decoration: none; background: var(--bg-medium); padding: 0.5rem 1rem; border-radius: 6px; margin-right: 1rem;">Act 2 →</a>
                <div class="view-toggle">
                    <button id="grid-view" class="active">Grid</button>
                    <button id="sequence-view">Sequence</button>
                </div>
            </div>
        </div>
    </header>

    <nav class="scene-nav" id="scene-nav">
        <!-- Generated by JS -->
    </nav>

    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-info">
            <span id="panel-count">56 panels</span>
            <span id="runtime">~12 minutes runtime</span>
        </div>
    </div>

    <main>
        <div class="panels-grid active" id="panels-grid">
            <!-- Generated by JS -->
        </div>

        <div class="panels-sequence" id="panels-sequence">
            <!-- Generated by JS -->
        </div>
    </main>

    <div class="lightbox" id="lightbox">
        <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
        <button class="lightbox-nav prev" onclick="navigateLightbox(-1)">&larr;</button>
        <div class="lightbox-content">
            <img id="lightbox-image-png" style="display: none;">
            <object id="lightbox-image-svg" type="image/svg+xml"></object>
            <div class="lightbox-info" id="lightbox-info"></div>
        </div>
        <button class="lightbox-nav next" onclick="navigateLightbox(1)">&rarr;</button>

        <button class="feedback-toggle" id="feedback-toggle" onclick="toggleFeedbackPanel()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <span id="feedback-toggle-count">Feedback</span>
        </button>

        <div class="lightbox-feedback" id="feedback-panel">
            <div class="feedback-header">
                <h3>
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    Panel Feedback
                </h3>
                <button onclick="toggleFeedbackPanel()" style="background: transparent; border: none; color: var(--text-muted); cursor: pointer; font-size: 1.2rem;">&times;</button>
            </div>
            <div class="feedback-comments" id="feedback-comments">
                <div class="loading-comments">Loading comments...</div>
            </div>
            <div class="feedback-form">
                <div id="feedback-message-area"></div>
                <textarea id="feedback-text" placeholder="Share your thoughts on this panel..." maxlength="2000"></textarea>
                <input type="text" id="feedback-name" placeholder="Your name (optional)" maxlength="50">
                <button onclick="submitFeedback()" id="submit-feedback-btn">Submit Feedback</button>
                <div class="form-note">Be constructive and specific. Director comments are highlighted.</div>
            </div>
        </div>
    </div>

    <!-- Director Login Modal -->
    <div class="director-login-modal" id="director-login-modal">
        <div class="director-login-content">
            <h3>Director Login</h3>
            <p style="margin-bottom: 1rem; color: var(--text-muted); font-size: 0.9rem;">Enter the director token to leave official feedback.</p>
            <input type="password" id="director-token-input" placeholder="Director token">
            <div id="director-login-error" style="color: #ff6b6b; font-size: 0.85rem; margin-bottom: 0.5rem;"></div>
            <div class="btn-row">
                <button class="secondary" onclick="closeDirectorLogin()">Cancel</button>
                <button class="primary" onclick="loginAsDirector()">Login</button>
            </div>
        </div>
    </div>

    <!-- Director Indicator -->
    <div class="director-indicator" id="director-indicator">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
        Director Mode
        <button onclick="logoutDirector()" title="Logout">&times;</button>
    </div>

    <script>
        // Panel data
        const scenes = [
            {
                num: 1,
                title: "INT. HOME - EVENING",
                duration: "3:30",
                complexity: 2,
                vfx: false,
                panels: [
                    { shot: "Wide Establishing", desc: "Living room, storm outside, kids on couch" },
                    { shot: "Medium - Leo", desc: "Leo in dinosaur pajamas hugging toy" },
                    { shot: "Tracking - Nina", desc: "Nina putting on earrings, multitasking" },
                    { shot: "Two-Shot", desc: "Gabe and Nina, overlapping dialogue" },
                    { shot: "Insert - Jenny", desc: "Jenny absorbed in phone" },
                    { shot: "Close-up - TV", desc: "TV flickering with static (foreshadowing)" },
                    { shot: "OTS - Kids", desc: "Kids watching TV, parents in background" },
                    { shot: "Close-up - Mia", desc: "Mia looking up, concerned - 'Promise?'" },
                    { shot: "Close-up - Gabe", desc: "Gabe hesitates, Nina glares, he promises" },
                ]
            },
            {
                num: 2,
                title: "EXT. HOUSE - NIGHT",
                duration: "0:15",
                complexity: 3,
                vfx: false,
                panels: [
                    { shot: "Wide - Exterior", desc: "House exterior, storm, lightning" },
                    { shot: "Tracking", desc: "Parents rush through rain to car" },
                    { shot: "Low Angle - Sky", desc: "Lightning cracks across sky" },
                ]
            },
            {
                num: 3,
                title: "INT. CAR - NIGHT",
                duration: "0:45",
                complexity: 2,
                vfx: false,
                panels: [
                    { shot: "Two-Shot - Driving", desc: "Gabe driving, Nina searching for phone" },
                    { shot: "Insert - Phone", desc: "Phone showing 'Calling Nina Cell'" },
                    { shot: "POV - Windshield", desc: "Rain-obscured road through windshield" },
                    { shot: "Close-up - Nina", desc: "Nina concerned, 'Be nicer to her'" },
                ]
            },
            {
                num: 4,
                title: "INT. HOUSE - MONTAGE",
                duration: "0:45",
                complexity: 2,
                vfx: false,
                panels: [
                    { shot: "Wide - Living Room", desc: "Peaceful living room, kids watching TV" },
                    { shot: "Insert - Jenny", desc: "Jenny texting, completely absorbed" },
                    { shot: "Insert - Phone", desc: "Nina's phone buzzing under cushion" },
                ]
            },
            {
                num: 5,
                title: "EXT. ROAD - TIME WARP",
                duration: "0:20",
                complexity: 5,
                vfx: true,
                panels: [
                    { shot: "POV - Time Warp", desc: "TIME WARP opens ahead of car" },
                    { shot: "Interior - Terror", desc: "Terror reaction, blue light flooding car" },
                    { shot: "Wide - Portal", desc: "Car enters massive blue portal" },
                    { shot: "Close-up - Vortex", desc: "Car consumed by swirling vortex" },
                ]
            },
            {
                num: 6,
                title: "INT. HOUSE - SIMULTANEOUSLY",
                duration: "0:20",
                complexity: 3,
                vfx: false,
                panels: [
                    { shot: "Wide - TV Explodes", desc: "TV explodes with static/sparks" },
                    { shot: "Reaction - All Three", desc: "Jenny, Mia, Leo all startled" },
                    { shot: "Low Light", desc: "Room dark, eerie atmosphere" },
                    { shot: "Insert - Phone Glow", desc: "Nina's phone glowing supernatural blue" },
                ]
            },
            {
                num: 7,
                title: "INT. CAR - JURASSIC DAY",
                duration: "1:30",
                complexity: 3,
                vfx: false,
                panels: [
                    { shot: "Close-up - Nina Wakes", desc: "Nina wakes, confused, daylight" },
                    { shot: "POV - Trashed Car", desc: "Chaos inside crashed car" },
                    { shot: "Insert - Toy Dinosaur", desc: "Toy T-Rex on dashboard (irony)" },
                    { shot: "Two-Shot", desc: "Nina rouses unconscious Gabe" },
                    { shot: "POV - Window", desc: "Lush prehistoric vegetation outside" },
                    { shot: "Wide - Swamp Reveal", desc: "Full Jurassic swamp reveal (wonder)" },
                ]
            },
            {
                num: 8,
                title: "EXT. JURASSIC SWAMP - T-REX",
                duration: "2:00",
                complexity: 5,
                vfx: true,
                panels: [
                    { shot: "Wide - Parents Emerge", desc: "Formal couple exits crashed car" },
                    { shot: "POV - Exotic Plants", desc: "Exploring prehistoric vegetation" },
                    { shot: "Medium - Weird Creature", desc: "Time warp and Jetplane glimpsed" },
                    { shot: "Close-up - Ground", desc: "Ground rumbles, water ripples" },
                    { shot: "Reaction - Creature Flees", desc: "Weird creature flees in terror" },
                    { shot: "Wide - T-REX APPEARS", desc: "HERO SHOT - T-Rex reveal" },
                    { shot: "Close-up - T-Rex Head", desc: "Terrifying T-Rex head detail" },
                    { shot: "Low Angle", desc: "T-Rex SMASHES the car" },
                    { shot: "Tracking - Flee", desc: "Parents flee into jungle" },
                ]
            },
            {
                num: 9,
                title: "EXT. JURASSIC BRUSH - CHASE",
                duration: "1:00",
                complexity: 5,
                vfx: true,
                panels: [
                    { shot: "Steadicam - Chase", desc: "Chase through giant ferns" },
                    { shot: "POV - Looking Back", desc: "T-Rex much closer than expected" },
                    { shot: "Wide - Destruction", desc: "T-Rex crashes through jungle" },
                    { shot: "Medium - New Threat", desc: "Second dinosaur blocks path" },
                    { shot: "Two-Shot - Running", desc: "Running and arguing (comedy)" },
                    { shot: "POV - Cave Spotted", desc: "Cave entrance - salvation" },
                    { shot: "Tracking - Slide In", desc: "Slide into cave, T-Rex arrives" },
                ]
            },
            {
                num: 10,
                title: "INT. CAVE - EMOTIONAL CLIMAX",
                duration: "1:30",
                complexity: 4,
                vfx: false,
                panels: [
                    { shot: "Wide - Cave Interior", desc: "T-Rex head at entrance, can't fit" },
                    { shot: "Insert - Claws", desc: "T-Rex claws scraping at entrance" },
                    { shot: "Two-Shot - Huddle", desc: "Parents huddle together, terror/relief" },
                    { shot: "Wide - Sound Design", desc: "Reacting to dinosaur battle outside" },
                    { shot: "Close-up - Nina", desc: "Fear transforms to determination" },
                    { shot: "Two-Shot - Realization", desc: "Both realize they left the KIDS" },
                    { shot: "Insert - Phone", desc: "Phone in Nina's hand - END ACT 1" },
                ]
            }
        ];

        let currentLightboxIndex = 0;
        let allPanels = [];

        // Initialize
        function init() {
            generateSceneNav();
            generatePanels();
            buildAllPanelsList();
            setupEventListeners();
        }

        function generateSceneNav() {
            const nav = document.getElementById('scene-nav');
            scenes.forEach((scene, idx) => {
                const btn = document.createElement('button');
                btn.className = 'scene-btn';
                btn.dataset.scene = scene.num;
                btn.dataset.vfx = scene.vfx;
                btn.textContent = `Scene ${scene.num}: ${scene.title.split(' - ')[0]}`;
                btn.onclick = () => scrollToScene(scene.num);
                nav.appendChild(btn);
            });
        }

        function generatePanels() {
            const gridContainer = document.getElementById('panels-grid');
            const sequenceContainer = document.getElementById('panels-sequence');

            scenes.forEach(scene => {
                // Sequence view - scene section
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'scene-section';
                sectionDiv.id = `scene-${scene.num}`;
                sectionDiv.innerHTML = `
                    <div class="scene-header">
                        <h2>
                            <span class="scene-indicator">Scene ${scene.num}</span>
                            ${scene.title}
                            ${scene.vfx ? '<span class="vfx-badge">MAJOR VFX</span>' : ''}
                        </h2>
                        <div class="scene-meta">
                            <span>Duration: ${scene.duration}</span>
                            <span>Panels: ${scene.panels.length}</span>
                            <span>Complexity: ${scene.complexity}/5</span>
                        </div>
                    </div>
                    <div class="scene-panels" id="scene-${scene.num}-panels"></div>
                `;
                sequenceContainer.appendChild(sectionDiv);

                const scenePanelsDiv = document.getElementById(`scene-${scene.num}-panels`);

                scene.panels.forEach((panel, panelIdx) => {
                    const panelNum = panelIdx + 1;
                    const baseFilename = `scene-${String(scene.num).padStart(2, '0')}-panel-${String(panelNum).padStart(2, '0')}`;
                    // Use PNG for Scene 1 (generated images), SVG placeholders for others
                    const ext = "png";
                    const filename = `${baseFilename}.${ext}`;

                    const cardHtml = ext === 'png' ? `
                        <div class="panel-card" data-file="${filename}" data-scene="${scene.num}" data-panel="${panelNum}">
                            <img src="${filename}" alt="Scene ${scene.num} Panel ${panelNum}">
                            <div class="panel-info">
                                <h3>${panel.shot}</h3>
                                <p>${panel.desc}</p>
                            </div>
                        </div>
                    ` : `
                        <div class="panel-card" data-file="${filename}" data-scene="${scene.num}" data-panel="${panelNum}">
                            <object data="${filename}" type="image/svg+xml"></object>
                            <div class="panel-info">
                                <h3>${panel.shot}</h3>
                                <p>${panel.desc}</p>
                            </div>
                        </div>
                    `;

                    // Add to grid
                    gridContainer.innerHTML += cardHtml;

                    // Add to sequence
                    scenePanelsDiv.innerHTML += cardHtml;
                });
            });
        }

        function buildAllPanelsList() {
            scenes.forEach(scene => {
                scene.panels.forEach((panel, idx) => {
                    const baseFilename = `scene-${String(scene.num).padStart(2, '0')}-panel-${String(idx + 1).padStart(2, '0')}`;
                    const ext = "png";
                    allPanels.push({
                        scene: scene.num,
                        panel: idx + 1,
                        file: `${baseFilename}.${ext}`,
                        isPng: ext === 'png',
                        shot: panel.shot,
                        desc: panel.desc,
                        sceneTitle: scene.title
                    });
                });
            });
        }

        function setupEventListeners() {
            // View toggles
            document.getElementById('grid-view').onclick = () => setView('grid');
            document.getElementById('sequence-view').onclick = () => setView('sequence');

            // Panel clicks
            document.addEventListener('click', (e) => {
                const card = e.target.closest('.panel-card');
                if (card) {
                    openLightbox(card.dataset.file);
                }
            });

            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (document.getElementById('lightbox').classList.contains('active')) {
                    if (e.key === 'ArrowLeft') navigateLightbox(-1);
                    if (e.key === 'ArrowRight') navigateLightbox(1);
                    if (e.key === 'Escape') closeLightbox();
                }
            });
        }

        function setView(view) {
            const gridBtn = document.getElementById('grid-view');
            const seqBtn = document.getElementById('sequence-view');
            const gridDiv = document.getElementById('panels-grid');
            const seqDiv = document.getElementById('panels-sequence');

            if (view === 'grid') {
                gridBtn.classList.add('active');
                seqBtn.classList.remove('active');
                gridDiv.classList.add('active');
                seqDiv.classList.remove('active');
            } else {
                gridBtn.classList.remove('active');
                seqBtn.classList.add('active');
                gridDiv.classList.remove('active');
                seqDiv.classList.add('active');
            }
        }

        function scrollToScene(num) {
            const section = document.getElementById(`scene-${num}`);
            if (section) {
                setView('sequence');
                setTimeout(() => {
                    section.scrollIntoView({ behavior: 'smooth' });
                }, 100);
            }
        }

        function openLightbox(file) {
            currentLightboxIndex = allPanels.findIndex(p => p.file === file);
            updateLightbox();
            document.getElementById('lightbox').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('active');
            document.body.style.overflow = '';
        }

        function navigateLightbox(direction) {
            currentLightboxIndex += direction;
            if (currentLightboxIndex < 0) currentLightboxIndex = allPanels.length - 1;
            if (currentLightboxIndex >= allPanels.length) currentLightboxIndex = 0;
            updateLightbox();
        }

        function updateLightbox() {
            const panel = allPanels[currentLightboxIndex];
            const pngEl = document.getElementById('lightbox-image-png');
            const svgEl = document.getElementById('lightbox-image-svg');

            if (panel.isPng) {
                pngEl.src = panel.file;
                pngEl.style.display = 'block';
                svgEl.style.display = 'none';
            } else {
                svgEl.data = panel.file;
                svgEl.style.display = 'block';
                pngEl.style.display = 'none';
            }

            document.getElementById('lightbox-info').innerHTML = `
                <strong>Scene ${panel.scene}: ${panel.sceneTitle}</strong> - Panel ${panel.panel}<br>
                ${panel.shot}: ${panel.desc}<br>
                <small>${currentLightboxIndex + 1} of ${allPanels.length}</small>
            `;

            // Update progress
            const progress = ((currentLightboxIndex + 1) / allPanels.length) * 100;
            document.getElementById('progress-fill').style.width = `${progress}%`;
        }

        // Initialize on load
        init();
    </script>
    <script src="../../../js/chat-widget.js"></script>
</body>
</html>
